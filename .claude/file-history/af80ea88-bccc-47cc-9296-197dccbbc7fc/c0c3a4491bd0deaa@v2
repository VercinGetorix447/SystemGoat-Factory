#!/bin/bash
# URL/Website Regex Checker v1
# Usage: url-checker.sh <url> [--full]

URL="$1"
FULL="${2:-}"

# Regex patterns
URL_REGEX='^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$'
EMAIL_REGEX='^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$'
PHONE_REGEX='^\+?[0-9]{10,14}$'
DOMAIN_REGEX='^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$'

# Colors
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m'

check_url() {
    if [[ $1 =~ $URL_REGEX ]]; then
        echo -e "${GREEN}✓ Valid URL format${NC}"
        return 0
    else
        echo -e "${RED}✗ Invalid URL format${NC}"
        return 1
    fi
}

check_live() {
    local status=$(curl -s -o /dev/null -w "%{http_code}" --max-time 5 "$1" 2>/dev/null)
    if [[ $status -ge 200 && $status -lt 400 ]]; then
        echo -e "${GREEN}✓ Live (HTTP $status)${NC}"
        return 0
    elif [[ $status -ge 400 ]]; then
        echo -e "${RED}✗ Error (HTTP $status)${NC}"
        return 1
    else
        echo -e "${YELLOW}? Unreachable${NC}"
        return 1
    fi
}

check_ssl() {
    if [[ $1 == https://* ]]; then
        local expiry=$(echo | openssl s_client -connect "${1#https://}":443 -servername "${1#https://}" 2>/dev/null | openssl x509 -noout -enddate 2>/dev/null | cut -d= -f2)
        if [ -n "$expiry" ]; then
            echo -e "${GREEN}✓ SSL valid until: $expiry${NC}"
        else
            echo -e "${YELLOW}? SSL check failed${NC}"
        fi
    else
        echo -e "${YELLOW}○ No HTTPS${NC}"
    fi
}

# Main
if [ -z "$URL" ]; then
    echo "Usage: url-checker.sh <url> [--full]"
    echo ""
    echo "Examples:"
    echo "  url-checker.sh https://example.com"
    echo "  url-checker.sh https://example.com --full"
    exit 1
fi

echo "=== URL Check: $URL ==="
echo ""

check_url "$URL"
URL_VALID=$?

if [ $URL_VALID -eq 0 ]; then
    # Add https if missing
    [[ $URL != http* ]] && URL="https://$URL"

    check_live "$URL"

    if [ "$FULL" == "--full" ]; then
        echo ""
        check_ssl "$URL"
        echo ""
        echo "Headers:"
        curl -sI --max-time 5 "$URL" 2>/dev/null | head -10
    fi
fi
