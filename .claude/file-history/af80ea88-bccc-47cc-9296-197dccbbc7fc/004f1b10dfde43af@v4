version: '3.8'

services:
  nocodb:
    image: nocodb/nocodb:latest
    container_name: nocodb
    restart: unless-stopped
    ports:
      - "8080:8080"
    volumes:
      - ./nocodb:/usr/app/data
    environment:
      - NC_AUTH_JWT_SECRET=claude-nocodb-secret-change-me
    networks:
      - claude-network

  pocketbase:
    image: ghcr.io/muchobien/pocketbase:latest
    container_name: pocketbase
    restart: unless-stopped
    ports:
      - "8090:8090"
    volumes:
      - ./pocketbase:/pb_data
    networks:
      - claude-network

  n8n:
    image: n8nio/n8n:latest
    container_name: n8n
    restart: unless-stopped
    user: root
    ports:
      - "5678:5678"
    volumes:
      - ./n8n:/home/node/.n8n
      - ./n8n-workflows:/workflows
      - /mnt/c/Users/password/Documents/.claude:/claude-data
    environment:
      - N8N_BASIC_AUTH_ACTIVE=true
      - N8N_BASIC_AUTH_USER=admin
      - N8N_BASIC_AUTH_PASSWORD=claude-n8n-password
      - GENERIC_TIMEZONE=America/Los_Angeles
      - TZ=America/Los_Angeles
      - N8N_SECURE_COOKIE=false
      - N8N_RUNNERS_DISABLED=true
      - EXECUTIONS_DATA_SAVE_ON_ERROR=all
      - EXECUTIONS_DATA_SAVE_ON_SUCCESS=all
      - DB_SQLITE_PATH=/claude-data/databases/workspace.db
    networks:
      - claude-network

  ntfy:
    image: binwiederhier/ntfy:latest
    container_name: ntfy
    restart: unless-stopped
    ports:
      - "8095:80"
    volumes:
      - ./ntfy/cache:/var/cache/ntfy
      - ./ntfy/etc:/etc/ntfy
    environment:
      - TZ=America/Los_Angeles
    command: serve
    networks:
      - claude-network

  planka-db:
    image: postgres:14-alpine
    container_name: planka-db
    restart: unless-stopped
    volumes:
      - planka-db-data:/var/lib/postgresql/data
    environment:
      - POSTGRES_DB=planka
      - POSTGRES_USER=planka
      - POSTGRES_PASSWORD=planka-secret-password
    networks:
      - claude-network

  planka:
    image: ghcr.io/plankanban/planka:latest
    container_name: planka
    restart: unless-stopped
    ports:
      - "3000:1337"
    volumes:
      - ./planka/user-avatars:/app/public/user-avatars
      - ./planka/project-backgrounds:/app/public/project-backgrounds
      - ./planka/attachments:/app/private/attachments
    environment:
      - BASE_URL=http://localhost:3000
      - DATABASE_URL=postgresql://planka:planka-secret-password@planka-db/planka
      - SECRET_KEY=claudeplankaverysecretkey32chars
      - DEFAULT_ADMIN_EMAIL=troy.allison@gmail.com
      - DEFAULT_ADMIN_PASSWORD=planka-admin-2026
      - DEFAULT_ADMIN_NAME=Troy
      - DEFAULT_ADMIN_USERNAME=troy
      - TZ=America/Los_Angeles
    depends_on:
      - planka-db
    networks:
      - claude-network

  metabase-db:
    image: postgres:14-alpine
    container_name: metabase-db
    restart: unless-stopped
    volumes:
      - metabase-db-data:/var/lib/postgresql/data
    environment:
      - POSTGRES_DB=metabase
      - POSTGRES_USER=metabase
      - POSTGRES_PASSWORD=metabase-secure-2026
    networks:
      - claude-network

  metabase:
    image: metabase/metabase:latest
    container_name: metabase
    restart: unless-stopped
    ports:
      - "3001:3000"
    volumes:
      - ./nocodb:/nocodb-data:ro
      - ./pocketbase:/pocketbase-data:ro
    environment:
      - MB_DB_TYPE=postgres
      - MB_DB_DBNAME=metabase
      - MB_DB_PORT=5432
      - MB_DB_USER=metabase
      - MB_DB_PASS=metabase-secure-2026
      - MB_DB_HOST=metabase-db
      - JAVA_OPTS=-Xmx2g
      - TZ=America/Los_Angeles
    depends_on:
      - metabase-db
    networks:
      - claude-network

networks:
  claude-network:
    driver: bridge

volumes:
  planka-db-data:
  metabase-db-data:
