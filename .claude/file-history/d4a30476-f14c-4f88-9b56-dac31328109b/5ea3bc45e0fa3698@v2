# Session: n8n Hetzner Stack Deployment
**Date:** 2026-01-30
**Host:** Hetzner CAX21 (ARM Ubuntu 22.04)
**Status:** Planning/Credential Gathering

---

## Objective
Deploy self-hosted n8n Community Edition stack with full client assessment pipeline for sales automation.

---

## Architecture Decisions

### Services to Deploy
| Service | Role | Domain |
|---------|------|--------|
| **Coolify** | Container orchestration, SSL, routing | (main host) |
| **n8n** | Workflow automation | n8n.{domain} |
| **PostgreSQL** | Primary database (n8n + NocoDB) | internal |
| **PocketBase** | Internal backend, templates, team auth | pb.{domain} |
| **NocoDB** | Content management UI | nocodb.{domain} |
| **Redis** | Optional queue mode for n8n | internal |

### External Services
| Service | Purpose |
|---------|---------|
| **Supabase** | Client-facing real-time DB for assessments |
| **DocuSeal** | Contract generation with JSON field injection |
| **Brave API** | Web search capabilities |
| **Unsplash API** | Image assets |
| **S3** | Primary backup destination |
| **Google Drive** | PDF sharing, human-accessible backups |

---

## Client Assessment Pipeline (Full Vision)

### Stage 1: Assessment Website (Astro + Supabase Real-time)
- Left side: Questions with 1-10 sliders
- Right side: 8 categories with live aggregate calculations
- Real-time updates as client answers

### Stage 2: Proposal Summary Page
- Pain points captured from client discussion
- Assessment results mapped to technical categories (pre-made options)
- 3 pricing tiers displayed (vertical rectangles with features)
- Recommendation selection by consultant

### Stage 3: DocuSeal Contract
- JSON inputs auto-populate contract fields
- Client name, selected package, pricing, terms
- E-signature capture

### Stage 4: Website Customization Demo
- Templates with customizers:
  - Color pickers
  - Font pickers
  - Background selection
  - Image placeholders
- Live preview of client's site
- Publish within 1-2 minutes

---

## Architectural Decisions Made

### Why Coolify (not Caddy/Traefik directly)
- Previous attempt with Hostinger + Docker + Traefik/Caddy failed
- Coolify abstracts reverse proxy complexity
- Provides deployment UI, secret management, health checks
- Short leash: if it doesn't work smoothly, we reconsider

### Why PocketBase + Supabase (both)
- **PocketBase**: Internal operations, template system, team auth
- **Supabase**: External client-facing real-time (assessment live calculations)
- Different audiences, different purposes

### Backup Strategy
- **S3**: Authoritative automated backups (DB dumps, volumes)
- **Google Drive**: Human-accessible files (PDFs, exports, sharing)
- Supabase used for app features, not as backup destination

---

## Credentials Needed (Pending)

### Host Access
- [ ] SSH connection details (IP, user, key/password)
- [ ] Domain name

### API Keys
- [ ] Brave Search API
- [ ] DocuSeal API + endpoint
- [ ] Unsplash Access Key
- [ ] Claude API key

### Backup Credentials
- [ ] S3 (endpoint, bucket, access key, secret)
- [ ] Google Drive OAuth path

### Supabase
- [ ] Project URL
- [ ] Anon key / Service Role key

### Passwords
- [ ] n8n basic auth password
- [ ] Other service passwords

---

## Deployment Plan (10 Steps)

1. **System Preparation** - Docker, Coolify, SSH hardening
2. **Services Setup** - n8n, Postgres, Redis, PocketBase, NocoDB
3. **Backups Configuration** - S3 daily, Google Drive partial
4. **Web APIs** - DocuSeal, Brave integration
5. **Secrets Management** - Coolify secrets injection
6. **Cron Jobs** - Automated backups, health checks
7. **Documentation** - Architecture diagram, URLs, restore instructions
8. **Approval Windows** - Pause at each major step
9. **Token Optimization** - Efficient n8n workflow design
10. **Best Practices** - Security, backup verification

---

## Session Log

### Memory System
- Fixed corrupted memory.jsonl (test-write appended to line 4)
- Loaded 4 entities: Troy, ClaudeProjectStructure, GoogleCloudProject, MCPServers

### Current Status
- Awaiting credentials to begin Step 1
- Architecture confirmed and documented

---

## Next Steps
1. User provides credentials
2. Begin Step 1: Connect to host, install Docker & Coolify
3. Approval checkpoint before proceeding

---

*Last updated: 2026-01-30*
