{
  "name": "Session Recorder (10 min)",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 10
            }
          ]
        }
      },
      "id": "trigger",
      "name": "Every 10 Minutes",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [0, 0]
    },
    {
      "parameters": {
        "command": "DATE=$(date '+%Y-%m-%d'); TIME=$(date '+%H:%M:%S'); sqlite3 /claude-data/databases/workspace.db \"INSERT INTO work_log (session_id, action_type, description, timestamp) VALUES ('auto-$DATE', 'CHECKPOINT', '10-minute automatic checkpoint', datetime('now'));\"; echo \"Checkpoint logged at $TIME\""
      },
      "id": "log-checkpoint",
      "name": "Log Checkpoint",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [220, 0]
    },
    {
      "parameters": {
        "command": "sqlite3 -json /claude-data/databases/workspace.db \"SELECT id, title, status, priority FROM tasks WHERE status != 'completed' ORDER BY priority, id;\" 2>/dev/null || echo '[]'"
      },
      "id": "get-active-tasks",
      "name": "Get Active Tasks",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [220, 200]
    },
    {
      "parameters": {
        "jsCode": "const timestamp = new Date().toISOString();\nconst checkpoint = $('Log Checkpoint').first().json.stdout;\nconst tasksRaw = $('Get Active Tasks').first().json.stdout || '[]';\n\nlet tasks = [];\ntry {\n  tasks = JSON.parse(tasksRaw);\n} catch (e) {\n  tasks = [];\n}\n\nconst summary = {\n  timestamp,\n  checkpoint_status: checkpoint,\n  active_tasks_count: tasks.length,\n  tasks: tasks.slice(0, 10),\n  next_checkpoint: new Date(Date.now() + 10 * 60 * 1000).toISOString()\n};\n\nreturn [{ json: summary }];"
      },
      "id": "create-summary",
      "name": "Create Summary",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [440, 100]
    },
    {
      "parameters": {
        "command": "echo '{{ JSON.stringify($json) }}' >> /claude-data/logs/session-recorder.jsonl"
      },
      "id": "append-log",
      "name": "Append to JSONL Log",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [660, 100]
    }
  ],
  "connections": {
    "Every 10 Minutes": {
      "main": [
        [
          { "node": "Log Checkpoint", "type": "main", "index": 0 },
          { "node": "Get Active Tasks", "type": "main", "index": 0 }
        ]
      ]
    },
    "Log Checkpoint": {
      "main": [
        [{ "node": "Create Summary", "type": "main", "index": 0 }]
      ]
    },
    "Get Active Tasks": {
      "main": [
        [{ "node": "Create Summary", "type": "main", "index": 0 }]
      ]
    },
    "Create Summary": {
      "main": [
        [{ "node": "Append to JSONL Log", "type": "main", "index": 0 }]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "tags": ["session", "recorder", "automation"]
}
