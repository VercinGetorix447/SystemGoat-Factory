{
  "name": "Daily Report Generator",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 18 * * *"
            }
          ]
        }
      },
      "id": "trigger",
      "name": "Daily at 6 PM",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [0, 0]
    },
    {
      "parameters": {
        "command": "sqlite3 /claude-data/databases/workspace.db \"SELECT title, status, completed_at FROM tasks WHERE date(completed_at) = date('now') OR date(created_at) = date('now');\""
      },
      "id": "get-today-tasks",
      "name": "Get Today's Tasks",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [220, 0]
    },
    {
      "parameters": {
        "command": "sqlite3 /claude-data/databases/workspace.db \"SELECT action_type, description, timestamp FROM work_log WHERE date(timestamp) = date('now') ORDER BY timestamp;\""
      },
      "id": "get-work-log",
      "name": "Get Work Log",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [220, 200]
    },
    {
      "parameters": {
        "jsCode": "const today = new Date().toISOString().split('T')[0];\nconst tasks = $input.first().json.stdout || 'No tasks';\nconst workLog = $('Get Work Log').first().json.stdout || 'No work logged';\n\nconst report = `# Daily Report: ${today}\n\n## Tasks Summary\n${tasks}\n\n## Work Log\n${workLog}\n\n---\nGenerated by n8n at ${new Date().toISOString()}\n`;\n\nreturn [{ json: { report, filename: `/claude-data/reports/${today}.md` } }];"
      },
      "id": "generate-report",
      "name": "Generate Report",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [440, 100]
    },
    {
      "parameters": {
        "command": "echo '{{ $json.report }}' > {{ $json.filename }}"
      },
      "id": "save-report",
      "name": "Save Report",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [660, 100]
    },
    {
      "parameters": {
        "command": "sqlite3 /claude-data/databases/workspace.db \"INSERT OR REPLACE INTO daily_reports (report_date, content, tasks_completed, tasks_created, updated_at) VALUES (date('now'), 'Generated', (SELECT COUNT(*) FROM tasks WHERE date(completed_at)=date('now')), (SELECT COUNT(*) FROM tasks WHERE date(created_at)=date('now')), datetime('now'));\""
      },
      "id": "update-db",
      "name": "Update DB Record",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [660, 300]
    }
  ],
  "connections": {
    "Daily at 6 PM": {
      "main": [
        [
          { "node": "Get Today's Tasks", "type": "main", "index": 0 },
          { "node": "Get Work Log", "type": "main", "index": 0 }
        ]
      ]
    },
    "Get Today's Tasks": {
      "main": [
        [{ "node": "Generate Report", "type": "main", "index": 0 }]
      ]
    },
    "Get Work Log": {
      "main": [
        [{ "node": "Generate Report", "type": "main", "index": 0 }]
      ]
    },
    "Generate Report": {
      "main": [
        [
          { "node": "Save Report", "type": "main", "index": 0 },
          { "node": "Update DB Record", "type": "main", "index": 0 }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "tags": ["report", "daily", "summary"]
}
