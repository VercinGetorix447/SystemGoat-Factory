{
  "name": "Memory Backup (10 min)",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 10
            }
          ]
        }
      },
      "id": "trigger",
      "name": "Every 10 Minutes",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [0, 0]
    },
    {
      "parameters": {
        "command": "sqlite3 /claude-data/databases/workspace.db \"SELECT json_group_array(json_object('id', id, 'title', title, 'status', status, 'priority', priority, 'created_at', created_at, 'updated_at', updated_at)) FROM tasks;\""
      },
      "id": "read-tasks",
      "name": "Read Tasks from SQLite",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [220, 0]
    },
    {
      "parameters": {
        "command": "cat /claude-data/Backups/memory-backup-$(date +%Y-%m-%d).md"
      },
      "id": "read-memory",
      "name": "Read Memory Backup",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [220, 200]
    },
    {
      "parameters": {
        "mode": "jsonToBinary",
        "options": {}
      },
      "id": "to-binary",
      "name": "Convert to Binary",
      "type": "n8n-nodes-base.moveBinaryData",
      "typeVersion": 1,
      "position": [440, 0]
    },
    {
      "parameters": {
        "fileName": "/claude-data/Backups/tasks-snapshot-{{ $now.format('yyyy-MM-dd-HHmm') }}.json",
        "options": {}
      },
      "id": "save-snapshot",
      "name": "Save Task Snapshot",
      "type": "n8n-nodes-base.writeBinaryFile",
      "typeVersion": 1,
      "position": [660, 0]
    },
    {
      "parameters": {
        "command": "sqlite3 /claude-data/databases/workspace.db \"INSERT INTO memory_snapshots (snapshot_data, source) VALUES ('$(date +%Y-%m-%d_%H:%M)', 'n8n-backup');\""
      },
      "id": "log-snapshot",
      "name": "Log Snapshot to DB",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [660, 200]
    }
  ],
  "connections": {
    "Every 10 Minutes": {
      "main": [
        [
          { "node": "Read Tasks from SQLite", "type": "main", "index": 0 },
          { "node": "Read Memory Backup", "type": "main", "index": 0 }
        ]
      ]
    },
    "Read Tasks from SQLite": {
      "main": [
        [{ "node": "Convert to Binary", "type": "main", "index": 0 }]
      ]
    },
    "Convert to Binary": {
      "main": [
        [{ "node": "Save Task Snapshot", "type": "main", "index": 0 }]
      ]
    },
    "Read Memory Backup": {
      "main": [
        [{ "node": "Log Snapshot to DB", "type": "main", "index": 0 }]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "tags": ["backup", "memory", "automation"]
}
